import{a as le}from"./chunk-IUG7E253.js";import{a as j,b as de}from"./chunk-RECW33DC.js";import{a as k}from"./chunk-OFLDPECS.js";import{b as D,e as U,i as T,j as E,m as P,n as A,p as B,s as N,t as R}from"./chunk-FVJTX4ET.js";import{a as L,b as $}from"./chunk-TVZEHG6P.js";import{a as pe}from"./chunk-P75LTJNG.js";import{d as re,g as ae}from"./chunk-F5SPSE3B.js";import{a as ue}from"./chunk-2RIL34TW.js";import"./chunk-OZDF3UU7.js";import"./chunk-CARY4E7O.js";import{X as ce,Y as se,Z as O,_ as h,c as me,f as F}from"./chunk-KND5QEEJ.js";import{j as ie}from"./chunk-SC2FGQQL.js";import{$b as ne,Ab as _,Ba as Y,C as J,Ca as M,Eb as C,Jb as v,Lb as c,T as Q,Tb as s,Ub as b,Va as Z,Vb as ee,Wb as te,Ya as i,Yb as S,Z as W,Za as d,_b as oe,ca as X,ha as g,mb as x,nb as w,o as G,ob as l,qa as p,ra as u,tb as f,wb as y,xb as V,yb as m,zb as r}from"./chunk-RHHFVKVY.js";var I=class o{constructor(t){this.http=t}baseUrl=F.baseUrl;getCommentOnVideo(t){return this.http.get(this.baseUrl+"comment/video/"+t)}postCommentOnVideo(t){return this.http.post(this.baseUrl+"comment/video/"+t.VideoId,t)}getSubcommentOnComment(t){return this.http.get(this.baseUrl+"comment/"+t)}postSubcommentOnComment(t){return this.http.post(this.baseUrl+"comment/"+t.id,t)}static \u0275fac=function(e){return new(e||o)(X(me))};static \u0275prov=W({token:o,factory:o.\u0275fac,providedIn:"root"})};var he=(o,t)=>t.id;function Ie(o,t){if(o&1){let e=C();m(0,"a",2),v("click",function(){p(e);let a=c();return u(a.showSubcomment=!a.showSubcomment)}),s(1),r()}if(o&2){let e,n=c();i(),ee("",(e=n.comment().subcomment)==null?null:e.length," replies")}}function Me(o,t){if(o&1){let e=C();m(0,"a",2),v("click",function(){p(e);let a=c();return u([a.addUserName(),a.showReply=!a.showReply])}),s(1),r()}if(o&2){let e=c();i(),b(e.showReply?"Cancel":"Reply")}}function we(o,t){if(o&1){let e=C();_(0,"br"),m(1,"mat-form-field",3)(2,"mat-label"),s(3,"Leave a comment"),r(),_(4,"input",4),m(5,"button",5),v("click",function(){p(e);let a=c();return u(a.postComment())}),m(6,"mat-icon"),s(7,"send"),r()()()}if(o&2){let e=c();i(),l("subscriptSizing","dynamic"),i(3),l("formControl",e.commentFormControl),i(),l("disabled",e.commentFormControl.value.trim().length==0),w("aria-label","send")}}function ye(o,t){if(o&1){let e=C();m(0,"app-comment-subcomment",7),v("updateComments",function(){p(e);let a=c(2);return u(a.updateTopComments())}),r()}if(o&2){let e=t.$implicit,n=c(2);l("comment",e)("videoId",n.videoId())}}function Ve(o,t){if(o&1&&y(0,ye,1,2,"app-comment-subcomment",6,he),o&2){let e=c();V(e.comment().subcomment)}}var z=class o{constructor(t,e){this._authService=t;this._commentService=e;this.loggedIn=this._authService.loggedIn,console.log(this.loggedIn())}comment=M.required();videoId=M.required();updateComments=Y();loggedIn;showReply=!1;showSubcomment=!1;commentFormControl=new T("",{nonNullable:!0});postComment(){let t={id:this.comment().parentcommentid||this.comment().id,VideoId:this.videoId(),comment:this.commentFormControl.value};this._commentService.postSubcommentOnComment(t).subscribe({next:e=>{console.log(e),this.updateComments.emit(!0),this.commentFormControl.reset(),this.showReply=!1}})}addUserName(){this.commentFormControl.setValue(`@${this.comment().User?.username} `)}updateTopComments(){this.updateComments.emit(!0)}static \u0275fac=function(e){return new(e||o)(d(k),d(I))};static \u0275cmp=g({type:o,selectors:[["app-comment-subcomment"]],inputs:{comment:[1,"comment"],videoId:[1,"videoId"]},outputs:{updateComments:"updateComments"},standalone:!0,features:[S],decls:7,vars:5,consts:[[1,"p"],["mat-button",""],["mat-button","",3,"click"],["appearance","outline",3,"subscriptSizing"],["rows","3","matInput","",3,"formControl"],["mat-icon-button","","matSuffix","",3,"click","disabled"],[3,"comment","videoId"],[3,"updateComments","comment","videoId"]],template:function(e,n){if(e&1&&(m(0,"div",0)(1,"div"),s(2),r(),x(3,Ie,2,1,"a",1)(4,Me,2,1,"a",1)(5,we,8,4)(6,Ve,2,0),r()),e&2){let a,K;i(2),b("@"+((a=n.comment().User)==null?null:a.username)+" : "+n.comment().comment),i(),f(n.comment().subcomment&&((K=n.comment().subcomment)!=null&&K.length)?3:-1),i(),f(n.loggedIn()?4:-1),i(),f(n.showReply?5:-1),i(),f(n.showSubcomment?6:-1)}},dependencies:[o,R,N,A,B,de,j,$,L,h,se,O,P,D,U,E],styles:[".p[_ngcontent-%COMP%]{border:1px solid gray;padding:8px;border-radius:1%;margin-bottom:8px}"]})};var Fe=(o,t)=>t.id;function ke(o,t){if(o&1){let e=C();m(0,"app-comment-subcomment",4),v("updateComments",function(){p(e);let a=c();return u(a.getComments())}),r()}if(o&2){let e=t.$implicit,n=c();l("comment",e)("videoId",n.videoId())}}function Oe(o,t){if(o&1){let e=C();m(0,"div",2)(1,"mat-form-field",5)(2,"mat-label"),s(3,"Leave a comment"),r(),_(4,"textarea",6),m(5,"button",7),v("click",function(){p(e);let a=c();return u(a.postComment())}),m(6,"mat-icon"),s(7,"send"),r()()()()}if(o&2){let e=c();i(),l("subscriptSizing","dynamic"),i(3),l("formControl",e.commentFormControl),i(),l("disabled",e.commentFormControl.value.trim().length==0),w("aria-label","send")}}function De(o,t){o&1&&(m(0,"p",3),s(1,"Login to comment"),r())}var q=class o{constructor(t,e){this._commentService=t;this._authService=e;this.loggedIn=this._authService.loggedIn}videoId=M.required();comments=[];loggedIn;commentFormControl=new T("",{nonNullable:!0});ngOnInit(){this.getComments()}getComments(){this._commentService.getCommentOnVideo(this.videoId()).subscribe({next:t=>{console.log(t),this.comments=t},error:t=>{console.log(t)}})}postComment(){let t={comment:this.commentFormControl.value.trim(),VideoId:this.videoId()};console.log(this.commentFormControl.value),this._commentService.postCommentOnVideo(t).subscribe({next:e=>{console.log(e),this.getComments(),this.commentFormControl.reset()}})}getSubcomment(){}postSubcomment(){}static \u0275fac=function(e){return new(e||o)(d(I),d(k))};static \u0275cmp=g({type:o,selectors:[["app-comment"]],inputs:{videoId:[1,"videoId"]},standalone:!0,features:[S],decls:5,vars:1,consts:[[1,"comments"],[3,"comment","videoId"],[1,"commentsinput"],[1,"nologincommentsinput"],[3,"updateComments","comment","videoId"],["appearance","outline",3,"subscriptSizing"],["rows","3","matInput","",3,"formControl"],["mat-icon-button","","matSuffix","",3,"click","disabled"]],template:function(e,n){e&1&&(m(0,"div",0),y(1,ke,1,2,"app-comment-subcomment",1,Fe),x(3,Oe,8,4,"div",2)(4,De,2,0,"p",3),r()),e&2&&(i(),V(n.comments),i(2),f(n.loggedIn()?3:4))},dependencies:[R,N,A,B,j,h,O,$,L,P,D,U,E,z],styles:[".comments[_ngcontent-%COMP%]{height:400px;overflow-y:scroll;padding-top:16px}.comments[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.commentsinput[_ngcontent-%COMP%]{position:sticky;bottom:0;margin-top:8px;width:100%;background-color:#fff}.commentsinput[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}@media (min-width: 1200px){.comments[_ngcontent-%COMP%]{height:500px}}.nologincommentsinput[_ngcontent-%COMP%]{text-align:center}"]})};function Ue(o,t){if(o&1){let e=C();m(0,"div",2)(1,"div",4)(2,"h1",5),s(3),r(),m(4,"button",6),v("click",function(){p(e);let a=c();return u(a.subscribe())}),s(5,"Subscribe"),r()(),m(6,"h4",7),s(7),r(),m(8,"h5",7),s(9),oe(10,"date"),r(),m(11,"h5",7)(12,"a",8),s(13),r()()()}if(o&2){let e=c();i(3),b(e.videoDetail.title),i(4),b(e.videoDetail.description),i(2),te(" ",e.videoDetail.views," views | ",ne(10,6,e.videoDetail.createdAt,"d MMM y , h:mm a"),""),i(3),l("routerLink","/user/"+e.videoDetail.UserId),i(),b("@"+(e.videoDetail.User==null?null:e.videoDetail.User.username))}}var _e=class o{constructor(t,e,n,a){this._route=t;this._videoService=e;this._userService=n;this._matSnackBar=a}baseUrl=`${F.baseUrl}video/`;videoId;videoDetail;ngOnInit(){this._route.paramMap.pipe(Q(t=>(this.videoId=Number(t.get("VideoId")),this._videoService.getVideoDetails(this.videoId))),J(t=>G(t))).subscribe({next:t=>{this.videoDetail=t,console.log(t)},error:t=>{console.log(t)}})}subscribe(){this._userService.subscribeToUser({UserId:this.videoDetail.UserId}).subscribe({next:t=>{this._matSnackBar.open("Subscribed","OK",{duration:2e3}),console.log("subscribed")},error:t=>{this._matSnackBar.open(t.error.message,"OK",{duration:2e3})}})}static \u0275fac=function(e){return new(e||o)(d(re),d(le),d(ue),d(pe))};static \u0275cmp=g({type:o,selectors:[["app-video"]],standalone:!0,features:[S],decls:4,vars:3,consts:[[1,"videocontainer"],["controls","",3,"src"],[1,"videodetailcontainer"],[3,"videoId"],[2,"display","flex","justify-content","space-between","align-items","center","margin-bottom","8px"],[2,"margin-bottom","0px"],["mat-flat-button","","color","accent",3,"click"],[2,"margin-bottom","8px"],[3,"routerLink"]],template:function(e,n){e&1&&(m(0,"div",0),_(1,"video",1),x(2,Ue,14,9,"div",2),_(3,"app-comment",3),r()),e&2&&(i(),l("src",n.baseUrl+n.videoId,Z),i(),f(n.videoDetail?2:-1),i(),l("videoId",n.videoId))},dependencies:[q,ie,h,ce,ae],styles:["video[_ngcontent-%COMP%]{border-radius:1%;width:100%}.videocontainer[_ngcontent-%COMP%]{width:80%;margin:auto}.videodetailcontainer[_ngcontent-%COMP%]{border:1px solid black;border-radius:1%;padding:8px}@media (min-width: 1200px){.videocontainer[_ngcontent-%COMP%]{display:flex;gap:10px;flex-wrap:wrap}video[_ngcontent-%COMP%]{width:70%}app-comment[_ngcontent-%COMP%]{flex-grow:1}.videodetailcontainer[_ngcontent-%COMP%]{order:3;width:70%}}"]})};export{_e as VideoComponent};
