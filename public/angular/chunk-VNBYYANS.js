import{a as xe}from"./chunk-ULYQQN6V.js";import{a as w,b as ge}from"./chunk-YDQBDVY2.js";import{a as be}from"./chunk-WRCLYY2A.js";import{a as Se}from"./chunk-WVQBT5OQ.js";import{c as pe,d as ue,f as ve,i as Ce}from"./chunk-QJPL2HDO.js";import{a as z}from"./chunk-OQJTPVCI.js";import{a as ye}from"./chunk-57VX2FDE.js";import{a as Ie}from"./chunk-YFNLUEF3.js";import{a as A,d as P,g as $,j as B,m as R,q as j,r as N,u as L}from"./chunk-YF2K7AJ4.js";import{b as I}from"./chunk-25A3FC3X.js";import{a as _e,b as he,c as y,d as M}from"./chunk-K4OZBMFI.js";import"./chunk-DKCBBMDY.js";import{c as fe,d as G,g as U,i as J}from"./chunk-6XXA7HXI.js";import{c as le,f as E}from"./chunk-MJRUFRT7.js";import{$ as Z,$b as ae,Ab as h,Ac as de,Ba as te,Ca as g,Eb as v,Hb as C,Jb as c,K as X,Nb as ne,Ob as oe,Pb as me,Rb as s,Sb as x,Tb as T,Ub as re,Va as ie,Wb as S,Ya as o,Za as l,_b as F,ac as ce,ea as ee,ha as b,mb as _,nb as D,ob as d,pc as se,qa as p,ra as u,tb as f,wb as O,xb as k,yb as r,zb as a}from"./chunk-CZHVG3FW.js";var V=class i{constructor(t){this.http=t}baseUrl=E.baseUrl;getCommentOnVideo(t){return this.http.get(this.baseUrl+"/comment/video/"+t)}postCommentOnVideo(t){return this.http.post(this.baseUrl+"/comment/video/"+t.VideoId,t)}getSubcommentOnComment(t){return this.http.get(this.baseUrl+"/comment/"+t)}postSubcommentOnComment(t){return this.http.post(this.baseUrl+"/comment/"+t.id,t)}static \u0275fac=function(e){return new(e||i)(ee(le))};static \u0275prov=Z({token:i,factory:i.\u0275fac,providedIn:"root"})};var ke=(i,t)=>t.id;function Te(i,t){if(i&1){let e=v();r(0,"a",2),C("click",function(){p(e);let m=c();return u(m.showSubcomment=!m.showSubcomment)}),s(1),a()}if(i&2){let e,n=c();o(),T("",(e=n.comment().subcomment)==null?null:e.length," replies")}}function Fe(i,t){if(i&1){let e=v();r(0,"a",2),C("click",function(){p(e);let m=c();return u([m.addUserName(),m.showReply=!m.showReply])}),s(1),a()}if(i&2){let e=c();o(),x(e.showReply?"Cancel":"Reply")}}function Ee(i,t){if(i&1){let e=v();h(0,"br"),r(1,"mat-form-field",3)(2,"mat-label"),s(3,"Leave a comment"),a(),h(4,"input",4),r(5,"button",5),C("click",function(){p(e);let m=c();return u(m.postComment())}),r(6,"mat-icon"),s(7,"send"),a()()()}if(i&2){let e=c();o(),d("subscriptSizing","dynamic"),o(3),d("formControl",e.commentFormControl),o(),d("disabled",e.commentFormControl.value.trim().length==0),D("aria-label","send")}}function Ue(i,t){if(i&1){let e=v();r(0,"app-comment-subcomment",7),C("updateComments",function(){p(e);let m=c(2);return u(m.updateTopComments())}),a()}if(i&2){let e=t.$implicit,n=c(2);d("comment",e)("videoId",n.videoId())}}function Ae(i,t){if(i&1&&(O(0,Ue,1,2,"app-comment-subcomment",6,ke),F(2,"sort")),i&2){let e=c();k(ce(2,0,e.comment().subcomment,!0,!1))}}var K=class i{constructor(t,e){this._authService=t;this._commentService=e;this.loggedIn=this._authService.loggedIn}comment=g.required();videoId=g.required();updateComments=te();loggedIn;showReply=!1;showSubcomment=!1;commentFormControl=new j("",{nonNullable:!0});postComment(){let t={id:this.comment().id,VideoId:this.videoId(),comment:this.commentFormControl.value,parentcommentid:this.comment().parentcommentid||this.comment().id};this._commentService.postSubcommentOnComment(t).subscribe({next:e=>{this.updateComments.emit(!0),this.commentFormControl.reset(),this.showReply=!1}})}addUserName(){}updateTopComments(){this.updateComments.emit(!0)}static \u0275fac=function(e){return new(e||i)(l(I),l(V))};static \u0275cmp=b({type:i,selectors:[["app-comment-subcomment"]],inputs:{comment:[1,"comment"],videoId:[1,"videoId"]},outputs:{updateComments:"updateComments"},standalone:!0,features:[S],decls:7,vars:5,consts:[[1,"p"],["mat-button",""],["mat-button","",3,"click"],["appearance","outline",2,"width","100%",3,"subscriptSizing"],["matInput","",3,"formControl"],["mat-icon-button","","matSuffix","",3,"click","disabled"],[3,"comment","videoId"],[3,"updateComments","comment","videoId"]],template:function(e,n){if(e&1&&(r(0,"div",0)(1,"div"),s(2),a(),_(3,Te,2,1,"a",1)(4,Fe,2,1,"a",1)(5,Ee,8,4)(6,Ae,3,4),a()),e&2){let m,Y;o(2),x("@"+((m=n.comment().User)==null?null:m.username)+" : "+n.comment().comment),o(),f(n.comment().subcomment&&((Y=n.comment().subcomment)!=null&&Y.length)?3:-1),o(),f(n.loggedIn()?4:-1),o(),f(n.showReply?5:-1),o(),f(n.showSubcomment?6:-1)}},dependencies:[i,$,z,A,w,M,he,y,P,L,B,R,N,be],styles:[".p[_ngcontent-%COMP%]{border:1px solid darkgray;padding:8px;border-radius:6px;margin-bottom:8px}"]})};var Pe=(i,t)=>t.id;function $e(i,t){if(i&1){let e=v();r(0,"div",1)(1,"mat-form-field",5)(2,"mat-label"),s(3,"Leave a comment"),a(),h(4,"textarea",6),r(5,"button",7),C("click",function(){p(e);let m=c();return u(m.postComment())}),r(6,"mat-icon"),s(7,"send"),a()()()()}if(i&2){let e=c();o(),d("subscriptSizing","dynamic"),o(3),d("formControl",e.commentFormControl),o(),d("disabled",e.commentFormControl.value.trim().length==0),D("aria-label","send")}}function Be(i,t){i&1&&(r(0,"p",2),s(1,"Login to comment"),a())}function Re(i,t){if(i&1){let e=v();r(0,"app-comment-subcomment",8),C("updateComments",function(){p(e);let m=c();return u(m.getComments())}),a()}if(i&2){let e=t.$implicit,n=c();d("comment",e)("videoId",n.videoId())}}var Q=class i{constructor(t,e){this._commentService=t;this._authService=e;se(()=>{this.getComments()})}videoId=g.required();comments=[];loggedIn;commentFormControl=new j("",{nonNullable:!0});ngOnInit(){this.loggedIn=this._authService.loggedIn}getComments(){this._commentService.getCommentOnVideo(this.videoId()).pipe(X(500)).subscribe({next:t=>{this.comments=t},error:t=>{console.error(t)}})}postComment(){let t={comment:this.commentFormControl.value.trim(),VideoId:this.videoId()};this._commentService.postCommentOnVideo(t).subscribe({next:e=>{this.getComments(),this.commentFormControl.reset()}})}getSubcomment(){}postSubcomment(){}static \u0275fac=function(e){return new(e||i)(l(V),l(I))};static \u0275cmp=b({type:i,selectors:[["app-comment"]],inputs:{videoId:[1,"videoId"]},standalone:!0,features:[S],decls:9,vars:1,consts:[[1,"container"],[1,"commentsinput"],[1,"nologincommentsinput"],[1,"comments"],[3,"comment","videoId"],["appearance","outline",3,"subscriptSizing"],["rows","3","matInput","",3,"formControl"],["mat-icon-button","","matSuffix","",3,"click","disabled"],[3,"updateComments","comment","videoId"]],template:function(e,n){e&1&&(r(0,"div",0),_(1,$e,8,4,"div",1)(2,Be,2,0,"p",2),r(3,"div",3),O(4,Re,1,2,"app-comment-subcomment",4,Pe),h(6,"br")(7,"br")(8,"br"),a()()),e&2&&(o(),f(n.loggedIn()?1:2),o(3),k(n.comments))},dependencies:[$,A,z,y,ge,w,P,L,B,R,N,K],styles:[".comments[_ngcontent-%COMP%]{height:320px;overflow-y:scroll}.comments[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.commentsinput[_ngcontent-%COMP%]{margin:0 0 8px;width:100%}.commentsinput[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}@media (min-width: 1200px){.comments[_ngcontent-%COMP%]{height:400px}.container[_ngcontent-%COMP%]{padding:0 0 0 8px}}.nologincommentsinput[_ngcontent-%COMP%]{text-align:center}"]})};function je(i,t){if(i&1){let e=v();r(0,"button",7),C("click",function(){p(e);let m=c(2);return u(m.subscribe())}),s(1),a()}if(i&2){let e=c(2);o(),T(" ",e.amISub?"Unsubscribe":"Subscribe"," ")}}function Ne(i,t){if(i&1){let e=v();r(0,"button",8),C("click",function(){p(e);let m=c(2);return u(m.deleteVideo())}),s(1,"Delete this video"),a()}}function Le(i,t){if(i&1){let e=v();r(0,"div",0)(1,"div",1)(2,"h1",2),s(3),a(),r(4,"div")(5,"button",3),C("click",function(){p(e);let m=c();return u(m.share())}),r(6,"mat-icon"),s(7,"share"),a()()()(),r(8,"h4",4),s(9),a(),r(10,"h5",4),s(11),F(12,"date"),a(),r(13,"h5",4)(14,"a",5),s(15),a(),s(16," \xA0 \xA0 \xA0 "),_(17,je,2,1,"button",6),a(),_(18,Ne,2,0,"button"),a()}if(i&2){let e=c();o(3),x(e.videoDetail.title),o(6),x(e.videoDetail.description),o(2),re(" ",e.videoDetail.views," views | ",ae(12,8,e.videoDetail.createdAt,"d MMM y , h:mm a"),""),o(3),d("routerLink","/user/"+e.videoDetail.UserId),o(),x("@"+(e.videoDetail.User==null?null:e.videoDetail.User.username)),o(2),f(e.isLoggedIn()?17:-1),o(),f(e.isAdmin()?18:-1)}}var H=class i{constructor(t,e,n,m,Y,qe,Ke){this._adminService=t;this._videoService=e;this._userService=n;this._matSnackBar=m;this._authService=Y;this.meta=qe;this.title=Ke;this.isAdmin=this._authService.isAdmin,this.isLoggedIn=this._authService.loggedIn}videoId=g.required();videoDetail;isAdmin;isLoggedIn;videoDetail$;subscribe$;report$;amISubscribed$;ngOnInit(){this.videoDetail$=this._videoService.getVideoDetails(this.videoId()).subscribe({next:t=>{this.videoDetail=t,this.title.setTitle(this.videoDetail.title),this.isLoggedIn()&&this.amISubscribed()}})}subscribe(){this.subscribe$=this._userService.subscribeToUser({UserId:this.videoDetail.UserId}).subscribe({next:t=>{this._matSnackBar.open(t.message,"OK",{duration:2e3}),this.amISub=t.message=="Subscribed"},error:t=>{this._matSnackBar.open(t.error.message,"OK",{duration:2e3})}})}deleteVideo(){this._adminService.deleteVideoById(this.videoId()).subscribe(t=>{this._matSnackBar.open("Deleted","OK",{duration:2e3})})}report(){this.report$=this._videoService.reportVideo(this.videoId()).subscribe(t=>{this._matSnackBar.open("Reported","OK",{duration:2e3})})}share(){navigator.share&&navigator.share({title:this.videoDetail.title,text:this.videoDetail.description,url:window.location.href}).then(()=>{}).catch(t=>{console.log("Error sharing:",t)})}amISub;amISubscribed(){this.amISubscribed$=this._userService.amISubscribed(this.videoDetail.UserId).subscribe({next:t=>{this.amISub=t.message=="yes"}})}ngOnDestroy(){this.videoDetail$&&this.videoDetail$.unsubscribe(),this.subscribe$&&this.subscribe$.unsubscribe(),this.report$&&this.report$.unsubscribe(),this.amISubscribed$&&this.amISubscribed$.unsubscribe()}static \u0275fac=function(e){return new(e||i)(l(xe),l(Se),l(Ie),l(ye),l(I),l(pe),l(ue))};static \u0275cmp=b({type:i,selectors:[["app-videodetail"]],inputs:{videoId:[1,"videoId"]},standalone:!0,features:[S],decls:1,vars:1,consts:[[1,"videodetailcontainer"],[2,"display","flex","justify-content","space-between","align-items","center","margin-bottom","8px"],[2,"margin-bottom","0px"],["mat-icon-button","","matTooltip","Share",1,"orangebutton",3,"click"],[2,"margin-bottom","8px"],[2,"font-size","14px",3,"routerLink"],["mat-stroked-button","","color","accent",2,"color","orange"],["mat-stroked-button","","color","accent",2,"color","orange",3,"click"],[3,"click"]],template:function(e,n){e&1&&_(0,Le,19,11,"div",0),e&2&&f(n.videoDetail?0:-1)},dependencies:[w,Ce,M,_e,y,de],styles:[".videodetailcontainer[_ngcontent-%COMP%]{border:1px solid darkgray;border-radius:6px;padding:8px;margin:8px 0}"]})};var ze=["videoplayer"],Ve=class i{constructor(t){this._route=t}baseUrl=`${E.baseUrl}/video/`;videoId;videoPlayer;parammap$;ngOnInit(){this.parammap$=this._route.paramMap.subscribe(t=>{this.videoId=Number(t.get("VideoId"))})}ngOnDestroy(){this.videoPlayer.nativeElement.src="",this.videoPlayer.nativeElement.load(),this.parammap$&&this.parammap$.unsubscribe()}static \u0275fac=function(e){return new(e||i)(l(ve))};static \u0275cmp=b({type:i,selectors:[["app-video"]],viewQuery:function(e,n){if(e&1&&ne(ze,7),e&2){let m;oe(m=me())&&(n.videoPlayer=m.first)}},standalone:!0,features:[S],decls:5,vars:4,consts:[["videoplayer",""],[1,"container"],["autoplay","","controls","",1,"shadow",3,"src"],[3,"videoId"]],template:function(e,n){e&1&&(r(0,"div",1),h(1,"video",2,0)(3,"app-videodetail",3)(4,"app-comment",3),a()),e&2&&(d("@slideFromTop",void 0),o(),d("src",n.baseUrl+n.videoId,ie),o(2),d("videoId",n.videoId),o(),d("videoId",n.videoId))},dependencies:[Q,M,H],styles:[".container[_ngcontent-%COMP%]{width:96%;margin:auto}video[_ngcontent-%COMP%]{border-radius:6px;width:100%;max-height:70vh}@media (min-width: 1200px){.container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}video[_ngcontent-%COMP%]{width:70%}app-comment[_ngcontent-%COMP%]{width:30%}app-videodetail[_ngcontent-%COMP%]{order:3;width:70%}}"],data:{animation:[fe("slideFromTop",[J(":enter",[U({opacity:0}),G("500ms ease-out",U({opacity:1}))]),J(":leave",[G("300ms ease-in",U({transform:"translateY(-100%)",opacity:0}))])])]}})};export{Ve as VideoComponent};
