import{a as U,c as O}from"./chunk-ZE5ZDUB2.js";import{a as E}from"./chunk-2AVGDEVC.js";import{a as R}from"./chunk-VGOS47CB.js";import{b as L}from"./chunk-4NPP5BVZ.js";import{a as M,g as B}from"./chunk-VBE3IEDN.js";import{a as I,d as w}from"./chunk-VN6LWNMF.js";import{f as A}from"./chunk-UYQAHJAI.js";import{Ab as a,Bb as n,Cb as v,Gb as k,Jb as u,Lb as l,Sb as D,Tb as s,Ub as x,Ya as r,Yb as T,Za as h,ha as b,mb as S,qa as d,qb as p,ra as m,rc as y,vb as C,wb as f,yb as _,zb as g}from"./chunk-LRPHIVML.js";function j(i,t){if(i&1&&(a(0,"mat-chip"),s(1),n()),i&2){let e=t.$implicit;r(),x("@"+e)}}function $(i,t){if(i&1&&(a(0,"h2"),s(1),n()),i&2){let e=t.$implicit;r(),x(e)}}function W(i,t){if(i&1){let e=k();a(0,"mat-chip-set")(1,"mat-chip"),s(2,"Users online :"),n(),_(3,j,2,1,"mat-chip",null,f),n(),a(5,"button",2),u("click",function(){d(e);let c=l();return m(c.sendAudio())}),s(6,"Start Recording"),n(),s(7,`
\xA0
`),a(8,"button",3),u("click",function(){d(e);let c=l();return m(c.stopAudio())}),s(9,"Send Recording"),n(),v(10,"br")(11,"hr"),a(12,"mat-form-field")(13,"mat-label"),s(14,"message:"),n(),v(15,"input",4,0),n(),a(17,"button",5),u("click",function(){d(e);let c=D(16),F=l();return m([F.sendText(c.value),c.value=""])}),s(18,"Send"),n(),_(19,$,2,1,"h2",null,f)}if(i&2){let e=l();r(3),g(e.allUsers),r(2),p("disabled",e.sendAudioDisabled),r(3),p("disabled",e.stopAudioDisabled),r(11),g(e.usertext)}}function N(i,t){i&1&&(a(0,"h1"),s(1,"Login to use"),n())}var V=class i{constructor(t,e){this._authenticateService=t;this._matSnackBar=e;this.loggedIn=this._authenticateService.loggedIn,this.userData=this._authenticateService.user_data,y(()=>{this.loggedIn()&&(!this.connection||this.connection.CLOSED)&&this.connect(),!this.loggedIn()&&this.connection&&(console.log("computed close"),this.connection.close())})}mediaRecorder;audioChunks=[];connection;sendAudioDisabled=!0;stopAudioDisabled=!0;loggedIn;userData;allUsers=[];ngOnInit(){}connect(){let t=A.wsAudioBaseUrl;this.connection=new WebSocket(t),this.connection.onopen=()=>{console.log("connection open",this.connection.readyState),this.sendAudioDisabled=!1,this.connection.readyState==1&&this.connection.send(this.userData().username)},this.connection.onmessage=e=>{typeof e.data=="string"?this.playThatText(e.data):this.playThatSong(e.data)},this.connection.onerror=e=>{console.error("WebSocket error:",e)},this.connection.onclose=()=>{console.log("WebSocket connection closed")}}sendAudio(){navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(t=>{this.sendAudioDisabled=!0,this.stopAudioDisabled=!1,this.mediaRecorder=new MediaRecorder(t,{audioBitsPerSecond:3e4}),this.mediaRecorder.ondataavailable=e=>{this.audioChunks.push(e.data)},this.mediaRecorder.onstop=()=>{let e=new Blob(this.audioChunks,{type:"audio/ogg"});this.audioChunks=[],this.connection.send(e),t.getTracks().forEach(o=>o.stop())},this.mediaRecorder.start(100),this.connection.send(this.userData().username+" recording")})}stopAudio(){this.sendAudioDisabled=!1,this.stopAudioDisabled=!0,this.connection.send(this.userData().username),this.mediaRecorder.stop()}playThatSong(t){let e=URL.createObjectURL(t),o=new Audio(e);o.muted=!0,o.play(),o.muted=!1}usertext=[];playThatText(t){t.includes("T9")?(this.checkLength(),this.usertext.unshift(t.split("T9")[1])):this.allUsers=t.split(",")}sendText(t){this.checkLength(),this.usertext.unshift(`@${this.userData().username} : ${t.trim()}`),this.connection.send(`T9${t.trim()}`)}checkLength(){this.usertext.length==15&&this.usertext.pop()}ngOnDestroy(){this.connection.close()}static \u0275fac=function(e){return new(e||i)(h(L),h(R))};static \u0275cmp=b({type:i,selectors:[["app-livechat"]],standalone:!0,features:[T],decls:3,vars:1,consts:[["message",""],[2,"width","80%","margin","auto","text-align","center"],["mat-stroked-button","","color","accent",3,"click","disabled"],["mat-stroked-button","","color","error",3,"click","disabled"],["matInput",""],["mat-stroked-button","","color","primary",3,"click"]],template:function(e,o){e&1&&(a(0,"div",1),S(1,W,21,2)(2,N,2,0,"h1"),n()),e&2&&(r(),C(o.loggedIn()?1:2))},dependencies:[w,I,O,U,E,B,M]})};export{V as a};
