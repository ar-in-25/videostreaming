import{a as j,c as $}from"./chunk-RNVF7TN5.js";import{a as O}from"./chunk-VWS7NXPC.js";import{a as V}from"./chunk-4W5H6ZLQ.js";import{a as U,g as F}from"./chunk-SWAGO2SH.js";import{b as M}from"./chunk-6JTWKR5Z.js";import{a as E,d as R}from"./chunk-NT7EVTU3.js";import{f as w}from"./chunk-MB4UZB3D.js";import{$a as f,Ab as a,Bb as n,Cb as x,Gb as T,Jb as p,Lb as l,Mc as B,Nc as S,Qc as h,Sb as A,Sc as C,Tb as r,Ub as b,Yb as L,_a as s,ja as k,ob as y,qb as u,sa as d,ta as m,tc as I,vb as D,wb as _,yb as g,zb as v}from"./chunk-ARRVSJN5.js";function P(i,t){if(i&1&&(a(0,"mat-chip"),r(1),n()),i&2){let e=t.$implicit;s(),b("@"+e)}}function Y(i,t){if(i&1&&(a(0,"h2"),r(1),n()),i&2){let e=t.$implicit;s(),b(e)}}function q(i,t){if(i&1){let e=T();a(0,"mat-chip-set")(1,"mat-chip"),r(2,"Users online :"),n(),g(3,P,2,1,"mat-chip",null,_),n(),a(5,"button",2),p("click",function(){d(e);let c=l();return m(c.sendAudio())}),r(6,"Start Recording"),n(),r(7," \xA0 "),a(8,"button",3),p("click",function(){d(e);let c=l();return m(c.stopAudio())}),r(9,"Send Recording"),n(),x(10,"br")(11,"hr"),a(12,"mat-form-field")(13,"mat-label"),r(14,"message:"),n(),x(15,"input",4,0),n(),a(17,"button",5),p("click",function(){d(e);let c=A(16),N=l();return m([N.sendText(c.value),c.value=""])}),r(18,"Send"),n(),g(19,Y,2,1,"h2",null,_)}if(i&2){let e=l();s(3),v(e.allUsers),s(2),u("disabled",e.sendAudioDisabled),s(3),u("disabled",e.stopAudioDisabled),s(11),v(e.usertext)}}function z(i,t){i&1&&(a(0,"h1"),r(1,"Login to use"),n())}var W=class i{constructor(t,e){this._authenticateService=t;this._matSnackBar=e;this.loggedIn=this._authenticateService.loggedIn,this.userData=this._authenticateService.user_data,I(()=>{this.loggedIn()&&(!this.connection||this.connection.CLOSED)&&this.connect(),!this.loggedIn()&&this.connection&&(console.log("computed close"),this.connection.close())})}mediaRecorder;audioChunks=[];connection;sendAudioDisabled=!0;stopAudioDisabled=!0;loggedIn;userData;allUsers=[];ngOnInit(){}connect(){let t=w.wsAudioBaseUrl;this.connection=new WebSocket(t),this.connection.onopen=()=>{console.log("connection open",this.connection.readyState),this.sendAudioDisabled=!1,this.connection.readyState==1&&this.connection.send(this.userData().username)},this.connection.onmessage=e=>{typeof e.data=="string"?this.playThatText(e.data):this.playThatSong(e.data)},this.connection.onerror=e=>{console.error("WebSocket error:",e)},this.connection.onclose=()=>{console.log("WebSocket connection closed")}}sendAudio(){navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(t=>{this.sendAudioDisabled=!0,this.stopAudioDisabled=!1,this.mediaRecorder=new MediaRecorder(t,{audioBitsPerSecond:3e4}),this.mediaRecorder.ondataavailable=e=>{this.audioChunks.push(e.data)},this.mediaRecorder.onstop=()=>{let e=new Blob(this.audioChunks,{type:"audio/ogg"});this.audioChunks=[],this.connection.send(e),t.getTracks().forEach(o=>o.stop())},this.mediaRecorder.start(100),this.connection.send(this.userData().username+" recording")})}stopAudio(){this.sendAudioDisabled=!1,this.stopAudioDisabled=!0,this.connection.send(this.userData().username),this.mediaRecorder.stop()}playThatSong(t){let e=URL.createObjectURL(t),o=new Audio(e);o.muted=!0,o.play(),o.muted=!1}usertext=[];playThatText(t){t.includes("T9")?(this.checkLength(),this.usertext.unshift(t.split("T9")[1])):this.allUsers=t.split(",")}sendText(t){this.checkLength(),this.usertext.unshift(`@${this.userData().username} : ${t.trim()}`),this.connection.send(`T9${t.trim()}`)}checkLength(){this.usertext.length==15&&this.usertext.pop()}ngOnDestroy(){this.connection.close()}static \u0275fac=function(e){return new(e||i)(f(M),f(V))};static \u0275cmp=k({type:i,selectors:[["app-livechat"]],standalone:!0,features:[L],decls:3,vars:2,consts:[["message",""],[2,"width","80%","margin","auto","text-align","center"],["mat-stroked-button","","color","accent",3,"click","disabled"],["mat-stroked-button","","color","error",3,"click","disabled"],["matInput",""],["mat-stroked-button","","color","primary",3,"click"]],template:function(e,o){e&1&&(a(0,"div",1),y(1,q,21,2)(2,z,2,0,"h1"),n()),e&2&&(u("@slideFromTop",void 0),s(),D(o.loggedIn()?1:2))},dependencies:[R,E,$,j,O,F,U],data:{animation:[B("slideFromTop",[C(":enter",[h({opacity:0}),S("500ms ease-out",h({opacity:1}))]),C(":leave",[S("300ms ease-in",h({transform:"translateY(-100%)",opacity:0}))])])]}})};export{W as a};
