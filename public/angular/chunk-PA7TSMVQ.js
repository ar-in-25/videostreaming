import{a as I}from"./chunk-TJF7TCZW.js";import{b as A}from"./chunk-76NFRR3S.js";import{a as w,d as B}from"./chunk-ON2JRT6O.js";import{a as T,c as L}from"./chunk-WZDNHQD2.js";import{f as y}from"./chunk-TAT732FB.js";import{Eb as C,Hb as p,Jb as r,Rb as s,Sb as D,Wb as k,Ya as c,Za as u,ha as f,mb as g,ob as h,pc as x,qa as l,ra as m,tb as v,ub as _,wb as b,xb as S,yb as a,zb as o}from"./chunk-J7P67657.js";function R(i,t){if(i&1&&(a(0,"mat-chip"),s(1),o()),i&2){let e=t.$implicit;c(),D("@"+e)}}function E(i,t){if(i&1){let e=C();a(0,"mat-chip-set",1)(1,"mat-chip"),s(2,"Users online :"),o(),b(3,R,2,1,"mat-chip",null,_),o(),a(5,"button",2),p("click",function(){l(e);let d=r();return m(d.sendAudio())}),s(6,"Start Recording"),o(),s(7,`
\xA0
`),a(8,"button",3),p("click",function(){l(e);let d=r();return m(d.stopAudio())}),s(9,"Send Recording"),o()}if(i&2){let e=r();c(3),S(e.allUsers),c(2),h("disabled",e.sendAudioDisabled),c(3),h("disabled",e.stopAudioDisabled)}}function U(i,t){i&1&&(a(0,"h1"),s(1,"Login to use"),o())}var M=class i{constructor(t,e){this._authenticateService=t;this._matSnackBar=e;this.loggedIn=this._authenticateService.loggedIn,this.userData=this._authenticateService.user_data,x(()=>{this.loggedIn()&&(!this.connection||this.connection.CLOSED)&&this.connect(),!this.loggedIn()&&this.connection&&(console.log("computed close"),this.connection.close())})}mediaRecorder;audioChunks=[];connection;sendAudioDisabled=!0;stopAudioDisabled=!0;loggedIn;userData;allUsers=[];ngOnInit(){}connect(){let t=y.wsBaseUrl;this.connection=new WebSocket(t),this.connection.onopen=()=>{console.log("connection open",this.connection.readyState),this.sendAudioDisabled=!1,this.connection.readyState==1&&this.connection.send(this.userData().username)},this.connection.onmessage=e=>{typeof e.data=="string"?this.playThatText(e.data):this.playThatSong(e.data)},this.connection.onerror=e=>{console.error("WebSocket error:",e)},this.connection.onclose=()=>{console.log("WebSocket connection closed")}}sendAudio(){navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(t=>{this.sendAudioDisabled=!0,this.stopAudioDisabled=!1,this.mediaRecorder=new MediaRecorder(t,{audioBitsPerSecond:2e4}),this.mediaRecorder.ondataavailable=e=>{this.audioChunks.push(e.data)},this.mediaRecorder.onstop=()=>{let e=new Blob(this.audioChunks,{type:"audio/ogg"});this.audioChunks=[],this.connection.send(e),t.getTracks().forEach(n=>n.stop())},this.mediaRecorder.start(100),this.connection.send(this.userData().username+" speaking")})}stopAudio(){this.sendAudioDisabled=!1,this.stopAudioDisabled=!0,this.connection.send(this.userData().username),this.mediaRecorder.stop()}playThatSong(t){let e=URL.createObjectURL(t),n=new Audio(e);n.muted=!0,n.play(),n.muted=!1}playThatText(t){this.allUsers=t.split(",")}ngOnDestroy(){this.connection.close()}static \u0275fac=function(e){return new(e||i)(u(A),u(I))};static \u0275cmp=f({type:i,selectors:[["app-livechat"]],standalone:!0,features:[k],decls:3,vars:1,consts:[[2,"width","80%","margin","auto","text-align","center"],["aria-label","Fish selection"],["mat-stroked-button","","color","accent",3,"click","disabled"],["mat-stroked-button","","color","error",3,"click","disabled"]],template:function(e,n){e&1&&(a(0,"div",0),g(1,E,10,2)(2,U,2,0,"h1"),o()),e&2&&(c(),v(n.loggedIn()?1:2))},dependencies:[B,w,L,T]})};export{M as a};
