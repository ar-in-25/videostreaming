import{a as pe}from"./chunk-H7KCZE6K.js";import{a as L,b as ue}from"./chunk-AEARE6NH.js";import{a as g}from"./chunk-QEWX6LTG.js";import{b as T,e as U,i as A,j as E,m as B,n as P,p as R,s as j,t as N}from"./chunk-MIGMUXZG.js";import{a as _e}from"./chunk-ZN3LDDAZ.js";import{a as $,b as z}from"./chunk-V2H42JNI.js";import{a as ve}from"./chunk-WY7RGWPX.js";import{a as Ce}from"./chunk-ZNNFQ6A6.js";import"./chunk-T56C2IX3.js";import"./chunk-CARY4E7O.js";import{R as le,S as de,T as D,U as I}from"./chunk-IA6APQGV.js";import{d as ce,g as se}from"./chunk-RUPW4M7W.js";import{c as ae,f as O}from"./chunk-3TYT3QDP.js";import{Aa as Z,Ba as w,C as Q,Db as C,Gb as v,I as V,Ib as c,Qb as s,Rb as S,Sb as te,T as W,Tb as oe,Ua as ee,Vb as x,Xa as n,Xb as ie,Ya as d,Yb as ne,Z as X,ca as Y,ha as h,lb as b,lc as me,mb as y,nb as l,o as J,pa as p,qa as u,sb as _,vb as k,vc as re,wb as F,xb as r,yb as a,zb as f}from"./chunk-7QAWOP5W.js";var M=class o{constructor(t){this.http=t}baseUrl=O.baseUrl;getCommentOnVideo(t){return this.http.get(this.baseUrl+"/comment/video/"+t)}postCommentOnVideo(t){return this.http.post(this.baseUrl+"/comment/video/"+t.VideoId,t)}getSubcommentOnComment(t){return this.http.get(this.baseUrl+"/comment/"+t)}postSubcommentOnComment(t){return this.http.post(this.baseUrl+"/comment/"+t.id,t)}static \u0275fac=function(e){return new(e||o)(Y(ae))};static \u0275prov=X({token:o,factory:o.\u0275fac,providedIn:"root"})};var we=(o,t)=>t.id;function Ve(o,t){if(o&1){let e=C();r(0,"a",2),v("click",function(){p(e);let m=c();return u(m.showSubcomment=!m.showSubcomment)}),s(1),a()}if(o&2){let e,i=c();n(),te("",(e=i.comment().subcomment)==null?null:e.length," replies")}}function ye(o,t){if(o&1){let e=C();r(0,"a",2),v("click",function(){p(e);let m=c();return u([m.addUserName(),m.showReply=!m.showReply])}),s(1),a()}if(o&2){let e=c();n(),S(e.showReply?"Cancel":"Reply")}}function ke(o,t){if(o&1){let e=C();f(0,"br"),r(1,"mat-form-field",3)(2,"mat-label"),s(3,"Leave a comment"),a(),f(4,"input",4),r(5,"button",5),v("click",function(){p(e);let m=c();return u(m.postComment())}),r(6,"mat-icon"),s(7,"send"),a()()()}if(o&2){let e=c();n(),l("subscriptSizing","dynamic"),n(3),l("formControl",e.commentFormControl),n(),l("disabled",e.commentFormControl.value.trim().length==0),y("aria-label","send")}}function Fe(o,t){if(o&1){let e=C();r(0,"app-comment-subcomment",7),v("updateComments",function(){p(e);let m=c(2);return u(m.updateTopComments())}),a()}if(o&2){let e=t.$implicit,i=c(2);l("comment",e)("videoId",i.videoId())}}function Oe(o,t){if(o&1&&k(0,Fe,1,2,"app-comment-subcomment",6,we),o&2){let e=c();F(e.comment().subcomment)}}var K=class o{constructor(t,e){this._authService=t;this._commentService=e;this.loggedIn=this._authService.loggedIn}comment=w.required();videoId=w.required();updateComments=Z();loggedIn;showReply=!1;showSubcomment=!1;commentFormControl=new A("",{nonNullable:!0});postComment(){let t={id:this.comment().parentcommentid||this.comment().id,VideoId:this.videoId(),comment:this.commentFormControl.value};this._commentService.postSubcommentOnComment(t).subscribe({next:e=>{this.updateComments.emit(!0),this.commentFormControl.reset(),this.showReply=!1}})}addUserName(){this.commentFormControl.setValue(`@${this.comment().User?.username} `)}updateTopComments(){this.updateComments.emit(!0)}static \u0275fac=function(e){return new(e||o)(d(g),d(M))};static \u0275cmp=h({type:o,selectors:[["app-comment-subcomment"]],inputs:{comment:[1,"comment"],videoId:[1,"videoId"]},outputs:{updateComments:"updateComments"},standalone:!0,features:[x],decls:7,vars:5,consts:[[1,"p"],["mat-button",""],["mat-button","",3,"click"],["appearance","outline",3,"subscriptSizing"],["rows","3","matInput","",3,"formControl"],["mat-icon-button","","matSuffix","",3,"click","disabled"],[3,"comment","videoId"],[3,"updateComments","comment","videoId"]],template:function(e,i){if(e&1&&(r(0,"div",0)(1,"div"),s(2),a(),b(3,Ve,2,1,"a",1)(4,ye,2,1,"a",1)(5,ke,8,4)(6,Oe,2,0),a()),e&2){let m,H;n(2),S("@"+((m=i.comment().User)==null?null:m.username)+" : "+i.comment().comment),n(),_(i.comment().subcomment&&((H=i.comment().subcomment)!=null&&H.length)?3:-1),n(),_(i.loggedIn()?4:-1),n(),_(i.showReply?5:-1),n(),_(i.showSubcomment?6:-1)}},dependencies:[o,N,j,P,R,ue,L,z,$,I,de,D,B,T,U,E],styles:[".p[_ngcontent-%COMP%]{border:1px solid gray;padding:8px;border-radius:1%;margin-bottom:8px}"]})};var De=(o,t)=>t.id;function Te(o,t){if(o&1){let e=C();r(0,"app-comment-subcomment",4),v("updateComments",function(){p(e);let m=c();return u(m.getComments())}),a()}if(o&2){let e=t.$implicit,i=c();l("comment",e)("videoId",i.videoId())}}function Ue(o,t){if(o&1){let e=C();r(0,"div",2)(1,"mat-form-field",5)(2,"mat-label"),s(3,"Leave a comment"),a(),f(4,"textarea",6),r(5,"button",7),v("click",function(){p(e);let m=c();return u(m.postComment())}),r(6,"mat-icon"),s(7,"send"),a()()()()}if(o&2){let e=c();n(),l("subscriptSizing","dynamic"),n(3),l("formControl",e.commentFormControl),n(),l("disabled",e.commentFormControl.value.trim().length==0),y("aria-label","send")}}function Ae(o,t){o&1&&(r(0,"p",3),s(1,"Login to comment"),a())}var q=class o{constructor(t,e){this._commentService=t;this._authService=e;me(()=>{this.getComments()})}videoId=w.required();comments=[];loggedIn;commentFormControl=new A("",{nonNullable:!0});ngOnInit(){this.loggedIn=this._authService.loggedIn}getComments(){this._commentService.getCommentOnVideo(this.videoId()).pipe(V(500)).subscribe({next:t=>{this.comments=t},error:t=>{console.error(t)}})}postComment(){let t={comment:this.commentFormControl.value.trim(),VideoId:this.videoId()};this._commentService.postCommentOnVideo(t).subscribe({next:e=>{this.getComments(),this.commentFormControl.reset()}})}getSubcomment(){}postSubcomment(){}static \u0275fac=function(e){return new(e||o)(d(M),d(g))};static \u0275cmp=h({type:o,selectors:[["app-comment"]],inputs:{videoId:[1,"videoId"]},standalone:!0,features:[x],decls:5,vars:1,consts:[[1,"comments"],[3,"comment","videoId"],[1,"commentsinput"],[1,"nologincommentsinput"],[3,"updateComments","comment","videoId"],["appearance","outline",3,"subscriptSizing"],["rows","3","matInput","",3,"formControl"],["mat-icon-button","","matSuffix","",3,"click","disabled"]],template:function(e,i){e&1&&(r(0,"div",0),k(1,Te,1,2,"app-comment-subcomment",1,De),b(3,Ue,8,4,"div",2)(4,Ae,2,0,"p",3),a()),e&2&&(n(),F(i.comments),n(2),_(i.loggedIn()?3:4))},dependencies:[N,j,P,R,L,I,D,z,$,B,T,U,E,K],styles:[".comments[_ngcontent-%COMP%]{height:400px;overflow-y:scroll;padding-top:16px}.comments[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.commentsinput[_ngcontent-%COMP%]{position:sticky;bottom:0;margin-top:8px;width:100%;background-color:#fff}.commentsinput[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}@media (min-width: 1200px){.comments[_ngcontent-%COMP%]{height:500px}}.nologincommentsinput[_ngcontent-%COMP%]{text-align:center}"]})};function Ee(o,t){if(o&1){let e=C();r(0,"button",10),v("click",function(){p(e);let m=c(2);return u(m.deleteVideo())}),s(1,"Delete this video"),a()}}function Be(o,t){if(o&1){let e=C();r(0,"div",2)(1,"div",4)(2,"h1",5),s(3),a(),r(4,"div")(5,"button",6),v("click",function(){p(e);let m=c();return u(m.report())}),s(6,"Report"),a(),s(7," \xA0 "),r(8,"button",7),v("click",function(){p(e);let m=c();return u(m.subscribe())}),s(9,"Subscribe"),a()()(),r(10,"h4",8),s(11),a(),r(12,"h5",8),s(13),ie(14,"date"),a(),r(15,"h5",8)(16,"a",9),s(17),a()(),b(18,Ee,2,0,"button"),a()}if(o&2){let e=c();n(3),S(e.videoDetail.title),n(8),S(e.videoDetail.description),n(2),oe(" ",e.videoDetail.views," views | ",ne(14,7,e.videoDetail.createdAt,"d MMM y , h:mm a"),""),n(3),l("routerLink","/user/"+e.videoDetail.UserId),n(),S("@"+(e.videoDetail.User==null?null:e.videoDetail.User.username)),n(),_(e.isAdmin()?18:-1)}}var xe=class o{constructor(t,e,i,m,H,Pe){this._route=t;this._videoService=e;this._userService=i;this._matSnackBar=m;this._authService=H;this._adminService=Pe;this.isAdmin=this._authService.isAdmin,this.isLoggedIn=this._authService.loggedIn}baseUrl=`${O.baseUrl}/video/`;videoId;videoDetail;isAdmin;isLoggedIn;ngOnInit(){this._route.paramMap.subscribe(t=>{this.videoId=Number(t.get("VideoId"))}),this._route.paramMap.pipe(V(500),W(t=>this._videoService.getVideoDetails(this.videoId)),Q(t=>J(t))).subscribe({next:t=>{this.videoDetail=t},error:t=>{console.error(t)}})}subscribe(){this._userService.subscribeToUser({UserId:this.videoDetail.UserId}).subscribe({next:t=>{this._matSnackBar.open("Subscribed","OK",{duration:2e3})},error:t=>{this._matSnackBar.open(t.error.message,"OK",{duration:2e3})}})}deleteVideo(){this._adminService.deleteVideoById(this.videoId).subscribe(t=>{this._matSnackBar.open("Deleted","OK",{duration:2e3})})}report(){this._videoService.reportVideo(this.videoId).subscribe(t=>{this._matSnackBar.open("Reported","OK",{duration:2e3})})}static \u0275fac=function(e){return new(e||o)(d(ce),d(pe),d(Ce),d(ve),d(g),d(_e))};static \u0275cmp=h({type:o,selectors:[["app-video"]],standalone:!0,features:[x],decls:4,vars:3,consts:[[1,"videocontainer"],["autoplay","","controls","",3,"src"],[1,"videodetailcontainer"],[3,"videoId"],[2,"display","flex","justify-content","space-between","align-items","center","margin-bottom","8px"],[2,"margin-bottom","0px"],["mat-flat-button","","color","warn",3,"click"],["mat-flat-button","","color","accent",3,"click"],[2,"margin-bottom","8px"],[3,"routerLink"],[3,"click"]],template:function(e,i){e&1&&(r(0,"div",0),f(1,"video",1),b(2,Be,19,10,"div",2),f(3,"app-comment",3),a()),e&2&&(n(),l("src",i.baseUrl+"/"+i.videoId,ee),n(),_(i.videoDetail?2:-1),n(),l("videoId",i.videoId))},dependencies:[q,re,I,le,se],styles:["video[_ngcontent-%COMP%]{border:1px solid black;border-radius:1%;width:100%}.videocontainer[_ngcontent-%COMP%]{width:80%;margin:auto}.videodetailcontainer[_ngcontent-%COMP%]{border:1px solid black;border-radius:1%;padding:8px}@media (min-width: 1200px){.videocontainer[_ngcontent-%COMP%]{display:flex;gap:10px;flex-wrap:wrap}video[_ngcontent-%COMP%]{width:70%}app-comment[_ngcontent-%COMP%]{flex-grow:1}.videodetailcontainer[_ngcontent-%COMP%]{order:3;width:70%}}"]})};export{xe as VideoComponent};
