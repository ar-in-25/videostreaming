import{a as _e}from"./chunk-D2OYIMFF.js";import{a as K,b as fe}from"./chunk-JMP4FPIU.js";import{b as x}from"./chunk-DX6YUJWO.js";import{a as he}from"./chunk-GC5C22B7.js";import{a as M,b as w}from"./chunk-E5DVJEZD.js";import{a as Ce}from"./chunk-OL75AHUY.js";import{a as be}from"./chunk-U4L2HJLG.js";import{a as Se}from"./chunk-LTBPLDJV.js";import{a as ue,b as ve}from"./chunk-OTL5ERWQ.js";import{Ca as L,Da as $,Ga as z,O as de,P as pe,Q as A,R as I,ma as E,pa as B,sa as P,ta as R,va as j,ya as N}from"./chunk-XMLJLDV6.js";import"./chunk-CARY4E7O.js";import{d as se,g as le}from"./chunk-3GCOAFMD.js";import{c as ce,f as U}from"./chunk-Q5JD2WOA.js";import{$a as m,Ab as T,Bb as n,Cb as r,Cc as ae,Db as f,E as W,Ea as ee,Fa as y,Hb as C,K as k,Kb as v,Mb as s,Ub as c,Vb as S,W as X,Wb as oe,Xb as ie,Ya as te,Zb as g,aa as Y,ab as d,ac as D,bc as ne,cc as me,fa as Z,ka as h,p as Q,pb as b,qb as F,rb as l,rc as re,ta as p,ua as u,wb as _,zb as O}from"./chunk-SWTISPDC.js";var V=class o{constructor(t){this.http=t}baseUrl=U.baseUrl;getCommentOnVideo(t){return this.http.get(this.baseUrl+"/comment/video/"+t)}postCommentOnVideo(t){return this.http.post(this.baseUrl+"/comment/video/"+t.VideoId,t)}getSubcommentOnComment(t){return this.http.get(this.baseUrl+"/comment/"+t)}postSubcommentOnComment(t){return this.http.post(this.baseUrl+"/comment/"+t.id,t)}static \u0275fac=function(e){return new(e||o)(Z(ce))};static \u0275prov=Y({token:o,factory:o.\u0275fac,providedIn:"root"})};var Fe=(o,t)=>t.id;function Oe(o,t){if(o&1){let e=C();n(0,"a",2),v("click",function(){p(e);let a=s();return u(a.showSubcomment=!a.showSubcomment)}),c(1),r()}if(o&2){let e,i=s();m(),oe("",(e=i.comment().subcomment)==null?null:e.length," replies")}}function Te(o,t){if(o&1){let e=C();n(0,"a",2),v("click",function(){p(e);let a=s();return u([a.addUserName(),a.showReply=!a.showReply])}),c(1),r()}if(o&2){let e=s();m(),S(e.showReply?"Cancel":"Reply")}}function De(o,t){if(o&1){let e=C();f(0,"br"),n(1,"mat-form-field",3)(2,"mat-label"),c(3,"Leave a comment"),r(),f(4,"input",4),n(5,"button",5),v("click",function(){p(e);let a=s();return u(a.postComment())}),n(6,"mat-icon"),c(7,"send"),r()()()}if(o&2){let e=s();m(),l("subscriptSizing","dynamic"),m(3),l("formControl",e.commentFormControl),m(),l("disabled",e.commentFormControl.value.trim().length==0),F("aria-label","send")}}function Ue(o,t){if(o&1){let e=C();n(0,"app-comment-subcomment",7),v("updateComments",function(){p(e);let a=s(2);return u(a.updateTopComments())}),r()}if(o&2){let e=t.$implicit,i=s(2);l("comment",e)("videoId",i.videoId())}}function Ae(o,t){if(o&1&&(O(0,Ue,1,2,"app-comment-subcomment",6,Fe),D(2,"sort")),o&2){let e=s();T(me(2,0,e.comment().subcomment,!0,!1))}}var q=class o{constructor(t,e){this._authService=t;this._commentService=e;this.loggedIn=this._authService.loggedIn}comment=y.required();videoId=y.required();updateComments=ee();loggedIn;showReply=!1;showSubcomment=!1;commentFormControl=new L("",{nonNullable:!0});postComment(){let t={id:this.comment().id,VideoId:this.videoId(),comment:this.commentFormControl.value,parentcommentid:this.comment().parentcommentid||this.comment().id};this._commentService.postSubcommentOnComment(t).subscribe({next:e=>{this.updateComments.emit(!0),this.commentFormControl.reset(),this.showReply=!1}})}addUserName(){this.commentFormControl.setValue(`@${this.comment().User?.username} `)}updateTopComments(){this.updateComments.emit(!0)}static \u0275fac=function(e){return new(e||o)(d(x),d(V))};static \u0275cmp=h({type:o,selectors:[["app-comment-subcomment"]],inputs:{comment:[1,"comment"],videoId:[1,"videoId"]},outputs:{updateComments:"updateComments"},standalone:!0,features:[g],decls:7,vars:5,consts:[[1,"p"],["mat-button",""],["mat-button","",3,"click"],["appearance","outline",3,"subscriptSizing"],["rows","3","matInput","",3,"formControl"],["mat-icon-button","","matSuffix","",3,"click","disabled"],[3,"comment","videoId"],[3,"updateComments","comment","videoId"]],template:function(e,i){if(e&1&&(n(0,"div",0)(1,"div"),c(2),r(),b(3,Oe,2,1,"a",1)(4,Te,2,1,"a",1)(5,De,8,4)(6,Ae,3,4),r()),e&2){let a,G;m(2),S("@"+((a=i.comment().User)==null?null:a.username)+" : "+i.comment().comment),m(),_(i.comment().subcomment&&((G=i.comment().subcomment)!=null&&G.length)?3:-1),m(),_(i.loggedIn()?4:-1),m(),_(i.showReply?5:-1),m(),_(i.showSubcomment?6:-1)}},dependencies:[o,R,P,E,B,fe,K,w,M,I,de,A,z,j,N,$,Ce],styles:[".p[_ngcontent-%COMP%]{border:1px solid gray;padding:8px;border-radius:1%;margin-bottom:8px}"]})};var Ee=(o,t)=>t.id;function Be(o,t){if(o&1){let e=C();n(0,"div",0)(1,"mat-form-field",4)(2,"mat-label"),c(3,"Leave a comment"),r(),f(4,"textarea",5),n(5,"button",6),v("click",function(){p(e);let a=s();return u(a.postComment())}),n(6,"mat-icon"),c(7,"send"),r()()()()}if(o&2){let e=s();m(),l("subscriptSizing","dynamic"),m(3),l("formControl",e.commentFormControl),m(),l("disabled",e.commentFormControl.value.trim().length==0),F("aria-label","send")}}function Pe(o,t){o&1&&(n(0,"p",1),c(1,"Login to comment"),r())}function Re(o,t){if(o&1){let e=C();n(0,"app-comment-subcomment",7),v("updateComments",function(){p(e);let a=s();return u(a.getComments())}),r()}if(o&2){let e=t.$implicit,i=s();l("comment",e)("videoId",i.videoId())}}var H=class o{constructor(t,e){this._commentService=t;this._authService=e;re(()=>{this.getComments()})}videoId=y.required();comments=[];loggedIn;commentFormControl=new L("",{nonNullable:!0});ngOnInit(){this.loggedIn=this._authService.loggedIn}getComments(){this._commentService.getCommentOnVideo(this.videoId()).pipe(k(500)).subscribe({next:t=>{this.comments=t},error:t=>{console.error(t)}})}postComment(){let t={comment:this.commentFormControl.value.trim(),VideoId:this.videoId()};this._commentService.postCommentOnVideo(t).subscribe({next:e=>{this.getComments(),this.commentFormControl.reset()}})}getSubcomment(){}postSubcomment(){}static \u0275fac=function(e){return new(e||o)(d(V),d(x))};static \u0275cmp=h({type:o,selectors:[["app-comment"]],inputs:{videoId:[1,"videoId"]},standalone:!0,features:[g],decls:5,vars:1,consts:[[1,"commentsinput"],[1,"nologincommentsinput"],[1,"comments"],[3,"comment","videoId"],["appearance","outline",3,"subscriptSizing"],["rows","3","matInput","",3,"formControl"],["mat-icon-button","","matSuffix","",3,"click","disabled"],[3,"updateComments","comment","videoId"]],template:function(e,i){e&1&&(b(0,Be,8,4,"div",0)(1,Pe,2,0,"p",1),n(2,"div",2),O(3,Re,1,2,"app-comment-subcomment",3,Ee),r()),e&2&&(_(i.loggedIn()?0:1),m(3),T(i.comments))},dependencies:[R,P,E,B,K,I,A,w,M,z,j,N,$,q],styles:[".comments[_ngcontent-%COMP%]{height:320px;overflow-y:scroll}.comments[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.commentsinput[_ngcontent-%COMP%]{margin:0 0 8px;width:100%;background-color:#fff}.commentsinput[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}@media (min-width: 1200px){.comments[_ngcontent-%COMP%]{height:400px}}.nologincommentsinput[_ngcontent-%COMP%]{text-align:center}"]})};function je(o,t){if(o&1){let e=C();n(0,"button",11),v("click",function(){p(e);let a=s(2);return u(a.deleteVideo())}),c(1,"Delete this video"),r()}}function Ne(o,t){if(o&1){let e=C();n(0,"div",2)(1,"div",4)(2,"h1",5),c(3),r(),n(4,"div")(5,"button",6),v("click",function(){p(e);let a=s();return u(a.report())}),n(6,"mat-icon"),c(7,"report"),r()(),c(8," \xA0 "),n(9,"button",7)(10,"mat-icon"),c(11,"share"),r()(),c(12," \xA0 "),n(13,"button",8),v("click",function(){p(e);let a=s();return u(a.subscribe())}),n(14,"mat-icon"),c(15,"person_add"),r()()()(),n(16,"h4",9),c(17),r(),n(18,"h5",9),c(19),D(20,"date"),r(),n(21,"h5",9)(22,"a",10),c(23),r()(),b(24,je,2,0,"button"),r()}if(o&2){let e=s();m(3),S(e.videoDetail.title),m(14),S(e.videoDetail.description),m(2),ie(" ",e.videoDetail.views," views | ",ne(20,7,e.videoDetail.createdAt,"d MMM y , h:mm a"),""),m(3),l("routerLink","/user/"+e.videoDetail.UserId),m(),S("@"+(e.videoDetail.User==null?null:e.videoDetail.User.username)),m(),_(e.isAdmin()?24:-1)}}var Ve=class o{constructor(t,e,i,a,G,Le){this._route=t;this._videoService=e;this._userService=i;this._matSnackBar=a;this._authService=G;this._adminService=Le;this.isAdmin=this._authService.isAdmin,this.isLoggedIn=this._authService.loggedIn}baseUrl=`${U.baseUrl}/video/`;videoId;videoDetail;isAdmin;isLoggedIn;ngOnInit(){this._route.paramMap.subscribe(t=>{this.videoId=Number(t.get("VideoId"))}),this._route.paramMap.pipe(k(500),X(t=>this._videoService.getVideoDetails(this.videoId)),W(t=>Q(t))).subscribe({next:t=>{this.videoDetail=t},error:t=>{console.error(t)}})}subscribe(){this._userService.subscribeToUser({UserId:this.videoDetail.UserId}).subscribe({next:t=>{this._matSnackBar.open("Subscribed","OK",{duration:2e3})},error:t=>{this._matSnackBar.open(t.error.message,"OK",{duration:2e3})}})}deleteVideo(){this._adminService.deleteVideoById(this.videoId).subscribe(t=>{this._matSnackBar.open("Deleted","OK",{duration:2e3})})}report(){this._videoService.reportVideo(this.videoId).subscribe(t=>{this._matSnackBar.open("Reported","OK",{duration:2e3})})}static \u0275fac=function(e){return new(e||o)(d(se),d(_e),d(Se),d(be),d(x),d(he))};static \u0275cmp=h({type:o,selectors:[["app-video"]],standalone:!0,features:[g],decls:4,vars:3,consts:[[1,"videocontainer"],["autoplay","","controls","",3,"src"],[1,"videodetailcontainer"],[3,"videoId"],[2,"display","flex","justify-content","space-between","align-items","center","margin-bottom","8px"],[2,"margin-bottom","0px"],["mat-mini-fab","","matTooltip","Report",1,"orangebutton",3,"click"],["mat-mini-fab","","matTooltip","Share",1,"orangebutton"],["mat-mini-fab","","matTooltip","Subscribe",1,"orangebutton",3,"click"],[2,"margin-bottom","8px"],[3,"routerLink"],[3,"click"]],template:function(e,i){e&1&&(n(0,"div",0),f(1,"video",1),b(2,Ne,25,10,"div",2),f(3,"app-comment",3),r()),e&2&&(m(),l("src",i.baseUrl+"/"+i.videoId,te),m(),_(i.videoDetail?2:-1),m(),l("videoId",i.videoId))},dependencies:[H,ae,I,pe,le,w,M,ve,ue],styles:["video[_ngcontent-%COMP%]{border:1px solid black;border-radius:1%;width:100%;max-height:70vh}.videocontainer[_ngcontent-%COMP%]{width:96%;margin:auto}.videodetailcontainer[_ngcontent-%COMP%]{border:1px solid black;border-radius:1%;padding:8px;margin-bottom:8px}@media (min-width: 1200px){.videocontainer[_ngcontent-%COMP%]{display:flex;gap:10px;flex-wrap:wrap}video[_ngcontent-%COMP%]{width:70%}app-comment[_ngcontent-%COMP%]{flex-grow:1}.videodetailcontainer[_ngcontent-%COMP%]{order:3;width:70%}}"]})};export{Ve as VideoComponent};
